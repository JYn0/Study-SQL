# SQL

Oracle 관리자 화면
http://127.0.0.1:8080/apex/f?p=4950

DB, DB,db

1. ## RDBMS

* SQL

```SQL
SELECT * FROM EMP;
SELECT * FROM DEPT;
SQL에서 제공

-- 한줄 주석
/*
여러줄 주석
*/
```



2. ## DDL

   #### 1) CREATE

   ```sql
   CREATE TABLE T_PRODUCT(
   	ID VARCHAR2(10),
   	PWD VARCHAR2(10),
   	NAME VARCHAR2(20),
       PRICE NUMBER(10,1)
   );
   
   DESC T_PRODUCT;
   ```

   VARCHAR : 가변문자열

   CHAR : 고정문자열 

   #### 2) DROP

   ```sql
   DROP TABLE T_PRODUCT;
   ```

   ​	DATA까지 모두 삭제

   #### 3) ALTER

   ```sql
   ALTER TABLE T_PRODUCT ADD (REGDATE DATE);
   ALTER TABLE T_PRODUCT DROP(REGDATE);
   ALTER TABLE T_PRODUCT ADD PRIMARY KEY(ID);
   ALTER TABLE T_PRODUCT MODIFY(NAME CHAR(10));
   ALTER TABLE T_PRODUCT RENAME COLUMN NAME TO UNAME;
   ALTER TABLE T_PRODUCT RENAME TO PRODUCT;
   ```

   ​	3번 제약조건(CONSTRAINT )



3. ## DML

   #### 1) INSERT

   ```sql
   CREATE TABLE T_USER(
   	ID VARCHAR2(10),
   	PWD VARCHAR2(10),
   	NAME VARCHAR2(20)
   );
   ALTER TABLE T_USER ADD PRIMARY KEY(ID);
   INSERT INTO T_USER VALUES ('ID01', 'PWD01', 'MUZI');
   INSERT INTO T_USER VALUES ('ID02', 'PWD02', 'CON');
   INSERT INTO T_USER VALUES ('ID03', 'PWD13', 'RYAN');
   INSERT INTO T_USER VALUES ('ID04', 'PWD04', 'NEO');
   INSERT INTO T_USER VALUES ('ID05', 'PWD05', 'APEACH');
   
   INSERT INTO T_USER () VALUES ()
   ```

ORA-00001: unique constraint (DB.SYS_C007101) violated
-> 중복된 

STRING 은 ' '

```sql
sql
   DESC T_PRODUCT;
   ALTER TABLE T_PRODUCT ADD PRIMARY KEY(ID);
   INSERT INTO T_PRODUCT VALUES();
INSERT INTO T_PRODUCT VALUES('P01', 'PANTS', 20000, SYSDATE);
   
INSERT INTO T_PRODUCT (ID, NAME, REGDATE)
   VALUES ('P02', 'PANTS2', SYSDATE);

   ALTER TABLE T_PRODUCT MODIFY (PRICE DEFAULT 1000);
   // DEFAULT 값 설정
   INSERT INTO T_PRODUCT (ID, NAME, REGDATE)
VALUES ('P03', 'PANTS3', SYSDATE);
   // PRICE는 1000 설정
   INSERT INTO T_PRODUCT
   VALUES ('P06', 'PANTS6', 100.322, SYSDATE);
   
   INSERT INTO T_USER VALUES ('ID10', 'PWD10', 'JAYZ');
   ROLLBACK;
   COMMIT;
```



   #### 	2) SELECT

SELECT 구조 / Alias AS / WHERE  AND  OR  NOT / Operation / ORDER BY / FUNCTION / 술어 / CASE

   ```sql
SELECT * FROM EMP; //모든 열

SELECT ENAME, SAL FROM EMP;
SELECT ENAME, SAL, DEPTNO AS DNO FROM EMP;

SELECT ENAME || JOB FROM EMP;
SELECT ENAME || JOB AS ENAMEANDJOB FROM EMP;
SELECT ENAME || ' ' || JOB AS ENAMEANDJOB FROM EMP;
SELECT ENAME || ' ' || SAL AS ENAMEANDJOB FROM EMP;// SAL이 문자열로 됨
SELECT DISTINCT (JOB) FROM EMP; //중복제거

SELECT * FROM EMP WHERE JOB = 'MANAGER'; //행 선택
SELECT * FROM EMP WHERE JOB = 'MANAGER' AND SAL > 2500;
//JOB에서 SAL>2500인 조건
SELECT * FROM EMP WHERE JOB = 'MANAGER' AND SAL > 2500 AND HIREDATE > '04/15.1981';
//AND여러번 쓸수있음
SELECT * FROM EMP WHERE JOB = 'MANAGER' AND ENAME LIKE '%A%';
// LIKE '%특정단어%' -> 특정단어를 가지고있는 것만 추출, '시작단어%' / '%끝나는단어'

SELECT ENAME, SAL,
-- 연봉을 계산하시오, SAL 13%, COMM 12% 세금
((SAL*12)*0.87)+((NVL(COMM,0)*12)*0.88) AS ANSAL
FROM EMP;
// NVL(COMM, 0)-> COMM에서 NULL값은 0으로 바꿔라

SELECT * FROM EMP WHERE COMM IS NULL;
//NULL값인 것만 출력
SELECT * FROM EMP WHERE COMM IS NOT NULL;
SELECT * FROM EMP WHERE SAL >= 2000;
SELECT * FROM EMP WHERE NOT (SAL >= 2000);

SELECT * FROM EMP WHERE SAL < 2000 AND DEPTNO=30 OR ENAME LIKE '%E%';

SELECT * FROM EMP WHERE JOB = 'CLERK' AND (DEPTNO =10 OR DEPTNO = 20);
SELECT * FROM EMP WHERE JOB = 'CLERK' AND NOT(DEPTNO =10 OR DEPTNO = 20);
   ```



 * 열에 별명 부여하기(Alias AS)

   ```SQL
   SELECT ENAME, SAL, DEPTNO AS DNO FROM EMP;
   //DEPTNO -> DNO로 출력
   SELECT ENAME, SAL, SAL*12 AS ASAL, DEPTNO AS DNO FROM EMP;
   //SAL*12 -> ASAL로 출력
   SELECT ENAME, SAL, SAL*12 AS "ANN SAL", DEPTNO AS DNO FROM EMP;
   //SAL*12 -> ANN SAL로 출력("열 명")
   ```

* 연산자

  ```
  = 같다
  <> NOT, ORACLE에서는 !=가능
  > < >= <=
  ```



재정렬

* ORDER BY

  ```SQL
  SELECT ENAME, SAL FROM EMP ORDER BY SAL ASC;
  SELECT ENAME, SAL FROM EMP WHERE SAL > 1000 AND DEPTNO = 20 ORDER BY SAL DESC;
  // SELECT하고(뽑아내고) 정렬
  =
  SELECT ENAME, SAL FROM EMP WHERE SAL > 1000 AND DEPTNO = 20 ORDER BY 2 DESC;
  SELECT ENAME, SAL FROM EMP WHERE SAL > 1000 AND DEPTNO = 20 ORDER BY 1 DESC;
  SELECT ENAME, SAL, SAL*12 FROM EMP WHERE SAL > 1000 AND DEPTNO = 20
  ORDER BY 3 ASC;
  //3번항(SLA*12)로 정렬
  
  SELECT * FROM EMP WHERE MGR IS NOT NULL ORDER BY MGR, ENAME;
  //MGR로 정렬하고 ENAME으로 정렬
  SELECT * FROM EMP WHERE COMM IS NOT NULL ORDER BY COMM DESC;
  ```




* #### 함수

  * 산술 함수

  ```SQL
  SELECT ENAME, SAL, ABS(SAL) FROM EMP; // 절댓값
  SELECT ENAME, SAL, MOD(SAL,3) FROM EMP; // 나머지
  SELECT ENAME, SAL, ROUND (SAL/7,3) AS BONUS FROM EMP; // 반올림
  ROUND(HIREDATE) -> 반올림
TRUNC(HIREDATE), -> 버림
  ```

  * 문자열 함수
  
  ```SQL
  SELECT ENAME || ' ' || JOB AS EJ FROM EMP;
  SELECT LOWER(ENAME) || ' ' || JOB AS EJ FROM EMP; // ENAME 소문자
  SELECT ENAME, SUBSTR(ENAME, 1, 3)FROM EMP; // 1~3 추출
  SELECT ENAME, SUBSTR(ENAME, 1, 3), REPLACE(ENAME,SUBSTR(ENAME, 1, 3), 'AAA') FROM EMP;
  //추출, 123을 AAA로 바꿔라
  
  SELECT ENAME, LENGTH(ENAME) FROM EMP; // 문자열 길이
  
  SELECT ENAME, -- 첫문자만 대문자로 만들어서 가져온다.
  REPLACE(ENAME,SUBSTR(ENAME, 2, LENGTH(ENAME)), LOWER(SUBSTR(ENAME, 2, LENGTH(ENAME))))
  FROM EMP;

  SELECT ENAME, SUBSTR(SAL,1,2)*10 FROM EMP; // 숫자는 자동으로 문자열로 변환되기도함
SELECT ENAME, SAL FROM EMP
  --WHERE DEPTNO = 20 OR DEPTNO = 30;
  WHERE DEPTNO IN(20,30); // IN (A, B) =>  A OR B / NOT IN(A, B) => NOT (A OR B)
  
```
  
  * 날짜 함수
  
  ```SQL
  날짜
  SYSDATE, CURRENT_DAT
  시간
  CURRENT_TIMESTAMP, TO_CHAR(CURRENT_TIMESTAMP, 'HH:MM:SS')
  SELECT ENAME, TO_CHAR(CURRENT_TIMESTAMP, 'YYYY:MM:DD:HH:MM:SS') AS TIME FROM EMP;
  SELECT ENAME, TO_CHAR(HIREDATE, 'YYYY:MM:DD'), SYSDATE, FROM EMP;
  TO_DATE : STRING -> DATE   TO_DATE('2019/05/31', 'YY:MM:DD')
  TO_STRING : DATE -> STRING TO_STRING()
  INSERT INTO T_PRODUCT VALUES('ID99','PANTS',10000, TO_DATE('2010/10/11','YY:MM:DD'));
  // 2010/10/11을 YY:MM:DD형식으로 넣겠다 -> 10/11/2010
  
  SELECT ENAME, HIREDATE, HIREDATE+1000 FROM EMP;
  //HIREDATE 1000일후 날짜
  
  SELECT ENAME, HIREDATE, SYSDATE-HIREDATE, MONTHS_BETWEEN (SYSDATE, HIREDATE) FROM EMP;
  // 두 날짜 기준으로 몇 일 /개월이 지났는지
  ```
  
  
  * 변환 함수
  
  ```SQL
  SELECT ENAME, SAL, COMM , NVL(COMM, 0)+SAL FROM EMP;
  NVL(COLUMN이름, 0) -> NULL이면 0으로 바꿔라
  
  SELECT ENAME, SAL, COMM , NVL2(COMM, '0', '1') FROM EMP;
  //NULL이면 0, 값이 있으면 1로 마킹, 바꾸는 것이 아니라 체크용도
  ```
  
  
  * 술어
  
  ```SQL
  SELECT ENAME, SAL FROM EMP WHERE SAL LIKE '5%';
  SELECT ENAME, HIREDATE, SYSDATE-HIREDATE, MONTHS_BETWEEN (SYSDATE, HIREDATE) FROM EMP;
  // 두 날짜 기준으로 몇 일 /개월이 지났는지
  SELECT ENAME, SAL FROM EMP WHERE SAL BETWEEN 2000 AND 5000; // 양끝단 포함
  IS NULL / IS NOT NULL
  IN <-> NOT IN
  LIKE
  BETWEEN
  ```
  
  
  * CASE
  
  ````SQL
  SELECT ENAME, 
  CASE WHEN JOB='PRESIDENT'
       THEN '왕'
       WHEN JOB='MANAGER'
       THEN '관리자'
       ELSE '직원'
  END AS GRADE
  FROM EMP;
  S
  SELECT ENAME, 
  CASE WHEN (SAL*12) >= 50000
       THEN '왕'
       WHEN (SAL*12) >= 30000 AND (SAL*12) < 50000
       THEN '관리자'
       ELSE '직원'
  END AS GRADE
  FROM EMP
  ORDER BY GRADE
  ````
  
  



   #### 	3)DELETE

   ```sql
   DELETE FROM T_USER WHERE ID='ID05';
   DELETE FROM T_USER WHERE <조건>;
   ```

   

   #### 	4) UPDATE

   ```SQL
   UPDATE T_USER SET PWD='111', NAME='JYn'
   UPDATE T_USER SET PWD='111', NAME='JYn' WHERE ID='ID03'
   ```

   

